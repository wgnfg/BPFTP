# BPFTP

一个基于现代.NET,Avalonia,Renci.SSH的SFTP跨平台客户端,易于定制(指在VS中改代码并编译部署)

#### 特点

- 纯C#.NET项目,代码完全透明,只有`Renci.SSH`相关Sftp相关操作会访问网络.
- 不卡,非常异步(哪卡了就提Issue)
- 非常跨平台,Avalonia本身支持的平台应该都可以跨.目前仅开放Windows和安卓2个比较有代表性的.后面慢慢补
- 支持`密码`和`SSH`2种Sftp验证方式.密码/`passphrase`存储使用各个平台自身的机制产生专用的key进行加密解密存储.当然,也可以自己改.
- UI不用被训狗/被瞎指挥/吃大锅饭,想要什么完全可以自己仅修改axaml定制
- 自己想要一些自用功能在手机上使用但没有一个砖厂,完全可以在这里自己加按钮然后直接C#代码实现(工作里不能这么干,但这里完全可以自由放开写)

#### 部分设计思路/已知问题/饼

- 目前界面部分是单页内部多层Content堆叠方式,直接一套梭哈全平台.
  - 目前项目关注点不在UI设计上,更多的是关注机制及功能.纯axaml画界面这些事情大家可以按照自己喜好去给自己定制.
  - 安卓平台的UI交互没做任何特殊处理,体验只能说是能用.(这应该也比较符合`Avalonia`的**具有一致的外观和行为**的宣传语)后面有时间会针对移动端操作进行单独适配,以及单独做画面.
  - 如果各位想以此项目为砖场,比划比划怎么用Avalonia在移动端上做出更像人的交互(比如给安卓平台单独重新axaml,`Popup`/`Dialog`等相关机制替换为使用安卓原生等),可以参考后面`自己改代码的一些建议`一节.
- 安卓等移动端可能额外需要后台传输等机制,否则会被杀,然后就似了.后面有时间会补充.目前轻度传个小文件前台使用问题不大.
- 目前完全没有使用的是流量WIFI等检查,也没写限速等机制,因此尽量在Wifi环境下使用
- C#与安卓的操作部分使用`Mono.Android`,不hybird `MaUI`.
  - 对于`Mono.Android`,我想正常情况大家应该都是**完全不会写**.但这个年代完全可以先AI代打然后自己再手动改改错确实可以比较完美地实现.NET与原生安卓的交互(但干这事还是很花时间的,并且跟在桌面上开发调试的体验相比就纯在赤石.赤完了也没钱拿.不是闲的没事干不建议干这种跟AI一起用C#写一堆Java命名空间的东西在安卓上一直炸这种抽象事.(不过对.NET玩家来说可能体验还比用AndroidStudio写原生好点?)hybird MaUI会有更多额外限制还得到处传MaUI的Activity,更赤石,还不如直接看谷歌的安卓文档学学正统安卓的设计)
  - 如果想单独探索一下用Mono.Android怎么玩,以及可以玩出什么东西,可以参考隔壁项目[ItsMyHu.NET](https://github.com/wgnfg/ItsMyHu.NET),上面会堆一些直接拿想要的权限之后用Mono.Android狂调安卓API能做到的玩法.也可以自己开个Avalonia跨平台项目让AI不用Maui直接用Mono.Android帮你写.
- 可能弄些自定义pipeline,比如上传前自动压缩加密,下载后自动解密解压这样？
- 图标是让AI乱画的,后面应该会换
- 项目目前开发时间较短,不想赤石可以养肥再体验

#### 为什么

- 手机/电脑传输文件总要经过某些不太可信的软件,云服务器传文件也会被扫盘(就算是仅扫哈希也很恶心了)我们需要一个完全透明/可以自己定制的软件

- 常用功能的软件要么太老,要么被设计/产品强行训狗/喂史.现在C#这么强完全可以重写很多东西

- 看到有不少关于Avalonia跨Android平台的讨论,但大伙想看的肯定也不是那点纯UI能直接跨的东西.这个项目也算是能展示Avalonia跨Android及其他平台时常见问题及处理方式的例子.比如跨平台时依赖注入的处理,安卓特有的权限配置及请求等.NET与安卓的交互

#### Usage(先不放图了)

##### 基本使用

- 最上方的连接管理CRUD
  - 按钮很直白了,没有连接时点增,下拉选中点连就连了
- SFTP连接,远端及本地的文件浏览及上传下载
  - 包含右键(安卓平台为长按)菜单的上传下载,双击进入文件夹
  - 选中并拖动到对面区域(仅限桌面端)
  - 传输进度显示及取消

##### 各个平台上的使用

- 共通部分
  - git clone这个仓库
  - 在你的Windows电脑上用VS2026打开这个项目
- Windows
  - 在VS中启动项目选.Desktop,点Run
  - 需要打包发布的场合,可以对.Desktop项目右键发布,然后根据自己需要点点点.
- Android
  - 保证手机打开开发者模式,如果没玩过这些,可以直接问问AI如何打开开发者模式和支持USB调试
  - 把手机插上数据线连电脑上,开启USB调试,选文件传输模式(不想连实机的场合可以用模拟器,比如逍遥)
  - 在VS中启动项目选.Android,设备选你的设备.然后点Run
    - 如果没有看到你的设备,一般是没选文件传输模式或者手机上在让你确认什么东西
    - VS偶尔会抽风,设备这里只有个Android Emulator,没啥太好解决办法.可能抽完风就好了.2026这种抽风频率比2022低了
  - 坐和放宽,如果过了一会你的手机上此项目成功运行了,说明你做对了.后面再想启动,就直接像其他app一样点图标启动.
  - 这里的代码大家应该也能看到在干什么,因此直接允许访问全体文件和网络权限即可
- Mac
  - TODO
- Linux
  - TODO


#### 自己改代码的一些建议

- 比较简单的改个宽高整个居中用控件库等操作随便弄,应该很容易知道改哪里.但这些过于个人喜好的东西不建议提PR让别人赤石.
- 希望完全定制主画面的场合
  - 在各个平台的入口中,都有`ConfigureServices`函数来注册此平台相关的依赖.也包含注册此平台使用的主画面的VM.比如安卓入口是这样
  ```cs
    services.AddSingleton<SftpWorkspaceViewModel, SftpWorkspaceForAndroidViewModel>();
  ```
  于是在安卓平台上被`ViewLocator`定位到的View的名字也就是`SftpWorkspaceForAndroid`.
  目前的`SftpWorkspaceForAndroid`是一个仅继承`SftpWorkspace`而无其他内容的类,仅用于偷`SftpWorkspace`的axaml并且占位.
  所以,如果希望完全定制安卓平台的主画面,可以删除本体中的`SftpWorkspaceForAndroid.cs`,创建axaml在里面写,此时,两个平台的主画面就会真的不一样.
  类似地,
  如果希望完全做出自己风格的主界面,建议不要直接修改原本的`SftpWorkspaceViewModel`及`SftpWorkspace.axaml`.
  而是VM直接继承`SftpWorkspaceViewModel`,随后创建对应名字的axaml在里面写,依赖注入时用增加的VM来保证使用你的View,以防这边代码更新后合并火葬场.
  如果认为自己的画面做的很好,可以将自己的axaml提PR加入项目中,各个版本的axaml共存,用户自己在依赖注入中自己选择各个平台使用的VM来决定使用的View.这也正是MVVM的意义之一.
- 安卓平台的其他定制
  - 对于`IViewService`中的`Popup`/`Dialog`等处理,可以在安卓平台上增加相关Service,实现成用Mono.Android直接new安卓原生的这些


#### 其他说明

- 只是个Sftp客户端,服务器或者其他可以作为Sftp服务端的东西还是自己弄.不会提供这些.
- 如果是希望局域网互传文件,或简单本机硬盘内部TP测试,没有sftp服务端,可以在`docker-desktop`里创建个容器挂载个本地目录并开放端口,随后局域网内部连接,然后添加连接信息(名字为foo,密码为pass,端口为2222)即可连接开始使用:

```sh
 docker run -d --name sftp-server   -p 2222:22  -v <你的本地路径>:/home/foo/upload   atmoz/sftp   foo:pass:1001
```


- 本项目依赖的开源软件包在 [`Directory.Packages.props`](./src/Directory.Packages.props) 中.感谢他们.